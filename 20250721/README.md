# ERC4337 paymaster
> paymaster는 4337의 AA 계정 추상화에서 새로운 트랜잭션의 내용으로 수수료를 대신 지불하는 스마트 계약
> 기존 사용자 계정 EOA의 단점을 극복하기 위해서 기존 지갑은 이더가 있어야 트랜잭션을 전송할수 있었지만
> 신규 지갑의 지식을 가지고 있지않은 사용자에게는 진입장벽이 컸다. 사용자 유입이 잘 안돼는 형태가 발생
> 플랫폼에서 가장 치명적인 문제 
> 이 부분을 해결하기 위한 방안으로 가스비를 대신 지불할 수 있다면

### paymaster의 목적과 역활
> 엔트리포인트에서 페이마스터로 수수료 지불을 해줄수 있는 사용자인지 검증 후 가스비 대납을 지향
> 사용자가 조건에 맞다면 혹은 가스비를 지출할수 있는 한도안이라면 결제를해서 사용자가 가스비가 없더라도 트랜잭션을 발생시켜서 사용자를 지갑의 지식이 없는 사용자들을 유입하는것이 목적

> 이전에 페이마스터 컨트랙트 화이트리스트 -> address => true
1. userOps 생성
2. entryPoint handleOps 호출
3. paymaster 검증 호출
> address => true
> token의 량이 몇개 이상 
> 호출하는 로직의 가스비가 일장량 한도에 맞는지
4. AA 스마트 계정 검증 및 로직 호출

### paymaster의 보안적인 요소
> 화이트 리스트 검증 : 내가 허용한 스마트 계정만 로직을 호출할수 있는 검증 -> 악의적 요청을 방지
> 토큰 량의 조건 : 실제 사용하는 토큰을 구매한 사용자만 호출할수 있는 검증
> 가스비 최대량 : 무제한 악의적은 요청 방지로 가스비 제한량 검증
> 확장 내용 : [페이마스터 주소]00000...[전달하는 컨텍스트 내용] 실행할때 컨텍스트를 전달해서 조건을 추가할수 있는 값

### 목적
> 사용자 가스비 지불의 조건 화이트 리스트 검증 토큰 보유량 검증 가스비 제한 
> paymasterAndData -> 앞 부분이 페이마스터의 주소 이후 000... 이후에 컨텍스트 내용
> paymasterAndData[:20] => 앞부분의 20 자리를 슬라이스 해서 사용 => 페이마스터 컨트랙트 주소
> validatePaymasterUserOp() : 트랜잭션 대납의 검증 함수
> sender : 요청자의 내용을 받아서 요청자가 화이트리스트 추가되어 있는지 그리고 해당 토큰 주소로 요청 보내서 잔액확인 잔액이 일정량 이상 있는지 검증
> maxCost : 사용자가 호출할수 있는 가스 최대량

### paymaster의 목적은
> userOperation의 처리 로직 이해
> 가스비 대납의 필요성 목적

