# ERC4337 번들러 
> ERC20 : 외부 메시지 발생시켜서 민트 

> 트랜잭션을 누가 대신 처리를 해주면 좋겠다 왜? 개인키를 모르는 사용자는 웹3 생태계에 접근하기가 힘드니까.
> 개인키가 있어야 트랜잭션을 발생시키기 수수료를 지불할수 있는데 이러한 수수료를 지불하는 구조는 일반인한테는 접근이 너무 어렵다
> 트랜잭션을 다른사람이 서명을 해서 대신 처리하고 가스도 대신 지불해서
> 사용자들의 유입을 높이자.
> 번들러 페이마스터가 이 역활의 목표를 가지고 있다. 번들러 -> 검증(엔트리포인트 + 페이마스터)

### 번들러
> 사용자 요청을 받아서 userOperation을 받아서 entryPoint에 전달하는 중개자 역활
> 검증은 페이마스터와 엔트리포인트의 검증을 호출하는 역활을 한다.

번들러(물류센터) -> 엔트리포인트(택배회사) - (배송 조건이 있는 사람들)(착불 요금 지불 대납자) -> 로직 실행 

사용자 -> (userOps) -> 번들러(userops의 서명) -> 엔트리포인트 + 페이마스터 -> 스마트 계정 로직 실행

### 페이마스터
> 엔트리포인트는 스마트 계정의 로직실행의 가스 수수료를 페이마스터가 지불할지 판단하는 로직을 검증하고
> 스마트 계정의 가스비를 대신 지불해준다. => 조건이 충족해야 제공을 해준다. 화이트리스트에 등록되어있는 스마트 계정들
> 유저들이 엔트리포인트에 전송한 이더량을 가지고 가스비 지불을 하게 할수도 있고 혹은 플랫폼에 결제를 시켜서 결제 금액만큼 대납자 계정이 처리를 해줘도 되고 조건은 확장할수 있다.

### 오늘 목표
> 번들러 + 스마트 계정 외부 컨트랙트 요청 ERC20 등의 토큰 발급

### 요약 
web2, web3
> web3의 탈중앙화의 단점을 극복하고자 만든것이 erc4337
> 그 안에 포함되는 번들러와 대납 계정은 web2의 환경에서 web3의 형태를 구현하기위한 목적
> KYC 신원 검증을 기반으로 검증된 사람들만 가스비를 대신 지불 해준다던지. 
> 추가적으로 결제 모듈 붙여서 미리 수수료를 지불해서 사용할수도 있는 플랫폼 제공
> erc20 토큰을 결제를 붙여서 구매시킨다음 사용자가 요청하나당 2토큰


### 번들러의 핵심 요소
> 번들러는 사용자 기존 EOA의 트랜잭션의 방식이 아닌 새로운 userOps라는 객체를 만들고 이것을 트랜잭션으로 사용하는데 새로운 트랜잭션을 수집하고 집계하는 역활을 하는 백엔드 서버 추상화 계정의 전용 트랜잭션을 관리하는 계층

1. 트랜잭션 풀 관리 : 사용자가 클라이언트에서 요청을 보낸 객체 userOps를 받아서 대기로 추가
2. 검증 관리 : userop의 유효성을 컨트랙트 이전에 검증 할수 있는 로직 페이마스터도 추가하는 로직
3. 집계 관리 : 여러 userOps를 얼마나 처리할건지 혹은 순서 정렬


remixd -s . -u https://remix.ethereum.org/