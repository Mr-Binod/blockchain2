# 체인 스왑 (멀티 체인 스왑)


# wrapper, DEX, 

## 멀티체인 스왑
- 블록체인 역사
    - 비트코인은 네트워크 자산을 표현하기위해서 제안한 개념
    - 이더리움 스마트 컨트랙트 제안한 네트워크 (계약이라는 용어로 법률적 개념을 코드로 표현할수 있다)
    - 이후에 멀티 체인 탄생 
    - 솔라나 바이넨스 폴리곤 아발란체 등등
    - 각각의 네트워크는 고유의 메인 토큰을 가지고 있다. (각각의 네트워크의 코인)


### 스왑 (같은 네트워크, 다른 네트워크)
> 용어적 표현은 교환하다
> 금융적으로도 표현하면 자산을 스왑 교환한다
> 블록체인에서 스왑은 한 자산의 종류를 다른 자산으로 바꾸는 행위

### 같은 네트워크에서 스왑 
> 이더리움 계열의 네트워크
> 같은 체인의 스왑은 탈중앙화 거래th DEX 에서 스왑 많이 제공한다
> 유동성 풀을 확보하고있는 안전한 탈중앙화 거래소에서 스왑을 하는것이 안전
> 이더리움 네트워크 스왑 => 이더리움 내에서 ETH를 < = > USDT로 교환
> 해당 네트워크에 있는 토큰 즉 CA 주소간의 ERC20 토큰 스왑
> DEX 거래소에서 제공을 한다. 스마트 컨트랙트 위에서 실행시키게 만든다.

### 다른 네트워크의 스왑 (멅티 체인 스왑)
> 서로 다른 네트워크에서 메인 토큰의 스왑
> ETH -> BNB 서로 다른 네트워크의 환경을 가지고 있는 네트워크간의 스왑
> 브릿지 다리의 역활을 하는 계층이 필요하다.
> 중앙화 브릿지에서느 ㄴ검증자들이 서명을 통과시켜줘야 스왑이 인정된다
> 오라클는(ORACLE) 탈중앙화 브릿지 
> 네트워크간에 소통이 되지않아서 브릿지에서 중간 다리 역활로 멀티 체인 
> 브릿지에서 레퍼 토큰으로 스왑으로 하고 이후에 -> DEX 의 유도성으르 가지고 스왑을 진행한다
> cloud funding 받고

### 스왑(DEX) 거래소
1. pancake 스왑 DEX (binance smart chain)
    - 이더리움 기반의 DEX
    - AMM 모델을 사용하는 거래소 : 자동화된 수학 공식을 사용한 유동성 풀 가격 측정(1 : 2)
    - 하나의 

2. pancake 스왑 DEX (바이넨스 스마트 체인)
    - 유니스왑을 포크해서 생성된 DEX 거래소 
    - 유동성 풀을 확보 하느 과정에서 유니스왑에서 넘어오면 보상을 주겠다
    - uniswap 보다 빠른 속도와 적은 수수료로 유동성을 확보했다


### 멀티체인에서 DEX가 필오한 이유
> 체인 내부에서 토큰을 교환하거나
> 체인 외부에서 브릿지를 통해서 Wrapped Token을 다른 매인 토큰을 ㅗ스왑하는 역활을 진핸해준다 (유동성)


### 브릿지
> 다른 네트워크의 구조 위의 계층에서 네트워크의 소통을 맡아서 진행
1. Lock : swap 신청한 네트워크에 자산을 잠금
2. Mint : Wrapped Token을 발행
3. Burn, Unlock : 다른 네트워크 토큰을 MINT 하는것이 소각 ,언락을 Wrapped Token을 다시 메인 토큰으로 잠금 해제

- 중앙화된 브릿지
- 탈중앙화 브릿지 (오라클)

- 탈중화 브릿지 위험하다

### Wrapped Token
> 네트워크의 원본 매인 자산을 포장헀다
> WBTC => 이더리움 네트워크에서 비트코인의 가치를 표현할수 있는 토큰 
> 체인마다 토큰의 표준이 다르기떄문에 브릿지에서 민트를 통해서 스왑


### wormhole hacking 사건

1. 단일 체인 구조 비트코인 (2008 ~ 2015) -> 네트워크에서 자산 전송

2. 스마트 컨트랙트 이더리움 (2015 ~ 2020) : 컨트랙트를 통해서 토큰 누구나 자산을 쉽게 표현한수 있다

3. 멀티체인 솔로나 바이넨스 등등 ( 2020 ~ 진핸중) : 체인간의 자산이 너무 분산되어있다보니 멀티체인의 스왑과 브릿지가 필요


#### 스왑의 종류
1. 코인 스왑 (네이티브 스왑) : 체인간의 거래가 불가능 하니 브릿지를 사용하는 스왑 형태
2. 토큰 스왑 (토큰 스왑) : 해당 네트워크 안에서 컨트랙트로 스왑 가능


### 브릿지 원리 
1. Lock을 통해서 ETH 자산을 잠근다 => 컨트랙트에 ETH 를 전송
2. 해당 컨트랙트의 이벤트중에서 LOCK이 발생하면 Relayer를 감자 (Relayer 서명 검증 단계를 거치고 검증자의 검증이 끝나면 wrapped Token을 민팅)
3. 다른 체이에서 이더리움의 동일한 가치를 가지는 Wrapped Token mint를 받고 이걸 DEX에서 스왑 가능
4. DEX 에서 스왑을 하게 되면 burn wETH을 소각하고 DEX 에서 폴리곤을 이더에 해당하는 가격만큰 계산해서 스왑
5. unlock Release 다시 토큰을 반환하고 이더를 잠금해제

오늘 목표 체인 간의 스왑을 ETH <=> POL 이전 사전 단계 이더리움 (sepolia) polygon (아모이 ) 네트워크 연결과 이론


### Relayer
> 오라클 서버의 내용 두체인의 이벤트를 구독하고 있는 중간 서버
> 하나의 체인에서 이벤트가 감지되면 다른 체인의 컨트랙트의 트랜잭션 호출


### Oracle 
> 매계체 사전적 의미로 외부의 정보를 어디로 전달한다
> 블록체인에서 오라클 서버는 네트워크 자체의 환경에서 다른 외부의 네트워크 혹은 외부 데이터의 접근을 할수 있는 매개체 역활
> 오프체인 데이터를 온체인을 ㅗ메시지를 전송하거나 반대로도 가능하게 하는 데이트의 중개자 역활

> chainlink : 가장 많이 사용되는 탈중아 오라클 네트워크
> 안정하지만 


### 브릿지와 오라클
> 브릿지의 목표 : 다른 네트워크의 자산을 전송 잠금

> 오라클의 목표 : 블록체인의 외부 정보 데이터를 단순하게 전달만 하는 역활 데이터의 중개역만 맡아서 처리한다

> 브릿지의 스왑을 통한 개념 안에 포함되는것이 오라클


### 보안 검증을 강화하는 방법
1. 다중 서명 검증
2. 타임락 unlock 을 사용
3. relayer 검증자들을 분산시킨다


#### 이더리움 네트워크와 폴리쿤 네트워크간의 스왑

> 두 네트워크 노드 RPC 엔드포인드 커넥션
> infura 
```sh

npm init -y
npm i ethers dotenv

```

- 스왑과 브릿지의 차이점과 멀티체인의 이해
- Lock Mint burn unlock의 흐름

### LOCK contract

> 해당 메인 토큰을 컨트랙트에 잠금
> 이벤트 발생시
> 다른 스왑할 네트워크에서 mint WrappedToken 발행


### 다른 멀티 네트워크 브릿지 제작 